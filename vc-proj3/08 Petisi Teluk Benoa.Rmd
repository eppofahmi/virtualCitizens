---
title: 'Laporan 3: Petisi Teluk Benoa'
author: "Ujang fahmi"
date: "5/4/2018"
output: 
  html_notebook:
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
  rmarkdown::pdf_document:
    fig_caption: yes
    includes:
      in_header: setup markdown.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.pos = "h")
```

# Pendahualuan
Data yang digunakan dalam lapporan ini berasal dari laman change.org. Data di dapat dengan melakukan scrapping dengan kata kunci teluk benoa. Komentar yang diambil berasal dari komentar pada petisi dengan jumlah pendukung terbanyak.

```{r}
# Runing RJava
if (Sys.info()['sysname'] == 'Darwin') {
  libjvm <- paste0(system2('/usr/libexec/java_home',stdout = TRUE)[1],'/jre/lib/server/libjvm.dylib')
  message (paste0('Load libjvm.dylib from: ',libjvm))
  dyn.load(libjvm)
}

library(tidyverse)
library(ggplot2)
library(stringr)
library(lubridate)
library(topicmodels)
library(tm)
library(tidytext)
library(RWeka)
library(reshape2)
library(wordcloud)
library(igraph)
library(ggraph)
library(quanteda)
```

# data

```{r}
dirwd <- paste(getwd(),"/wrangled data proj-3/",sep='')

# daftar petisi
daftar_petisi <- read.csv(paste(dirwd,"daftar petisi benoa.csv", sep=''), header = TRUE, sep = ',', stringsAsFactors = FALSE)

daftar_petisi$jml_pendukung <- as.integer(daftar_petisi$jml_pendukung)
daftar_petisi$date <- as.Date(daftar_petisi$date, "%Y-%m-%d")

petisi_tb <- read.csv(paste(dirwd,"petisi_tb.csv", sep=''), header = TRUE, sep = ',', stringsAsFactors = FALSE)
```

## Daftar Petisi

```{r}
print(daftar_petisi$title)
```

```{r, fig.cap="jumlah pendukung tiap petisi"}
daftar_petisi %>%
  select(date,title, jml_pendukung) %>%
  arrange(desc(jml_pendukung)) %>%
  ggplot(aes(reorder(date, jml_pendukung), jml_pendukung)) + geom_col() +
  coord_flip() + labs(x = NULL, y = "Jumlah Pendukung") + 
  ggtitle("Petisi dengan pendukung terbanyak") +
  labs(c = "Tanggal pembuatan Petisi", y = "Tanggal pembuatan Petisi")
```

terdapat tiga petisi yang didukung oleh lebih dari 50 ribu penandatangan. Berikut adalah daftarnya. 

```{r}
daftar_petisi %>%
  filter(jml_pendukung >= 50000) %>%
  select(title, date, inisiator) %>%
  arrange(date)
```

**Keterangan:** Untuk mengetahui inisiator petisi geser tanda plas disamping `date` pada tabel di atas. 

Untuk mendalami di seputar teluk benua, selanjutnya akan digunakan data berupa komentar dari tiga petisi dengan judul di atas. 

## Jumlah Komentar
Gambar berikut menunjukkan jumlah komentar untuk tiga petisi yang memiliki kata teluk benoa dengan pendukung paling banyak. 

```{r}
petisi_tb %>%
  select(judul) %>%
  group_by(judul) %>%
  count(judul) %>%
  ggplot(aes(judul, n)) + geom_col() +
  ggtitle("Jumlah komentar masing-masing petisi") +
  labs(x = "Judul Petisi", y ="Jumlah")
```

# Term

## Term Petisi 1
```{r}
petisi_tb %>%
  filter(judul == "petisi_1") %>%
  filter(word_count >= 2) %>%
  select(alasan_clean, word_count) %>%
  unnest_tokens(kata, alasan_clean, token = "ngrams", n = 2) %>%
  count(kata, sort = TRUE) %>%
  filter(!str_detect(kata, "teluk benoa")) %>%
  filter(!str_detect(kata, "alam alam")) %>%
  head(n = 20) %>%
  ggplot(aes(reorder(kata, n), n)) + geom_col() + coord_flip() +
  labs(x = "bigram", y = "jumlah bigram")
```

### tanah kelahiran

```{r}
petisi_tb %>%
  filter(str_detect(alasan, "tanah kelahiran")) %>%
  arrange(desc(likes)) %>%
  select(alasan) %>%
  print()
```


## Term Petisi 2

```{r}
petisi_tb %>%
  filter(judul == "petisi_2") %>%
  filter(word_count >= 2) %>%
  select(alasan_clean, word_count) %>%
  unnest_tokens(kata, alasan_clean, token = "ngrams", n = 2) %>%
  count(kata, sort = TRUE) %>%
  filter(!str_detect(kata, "teluk benoa")) %>%
  head(n = 20) %>%
  ggplot(aes(reorder(kata, n), n)) + geom_col() + coord_flip() +
  labs(x = "bigram", y = "jumlah bigram")
```

### revitalisasi teluk 

```{r}
petisi_tb %>%
  filter(str_detect(alasan, "revitalisasi teluk")) %>%
  arrange(desc(likes)) %>%
  select(alasan) %>%
  print()
```



## Term Petisi 3

```{r}
petisi_tb %>%
  filter(judul == "petisi_3") %>%
  filter(word_count >= 2) %>%
  select(alasan_clean, word_count) %>%
  unnest_tokens(kata, alasan_clean, token = "ngrams", n = 2) %>%
  count(kata, sort = TRUE) %>%
  filter(!str_detect(kata, "teluk benoa")) %>%
  head(n = 20) %>%
  ggplot(aes(reorder(kata, n), n)) + geom_col() + coord_flip() +
  labs(x = "bigram", y = "jumlah bigram")
```


### Tri hita karana
```{r}
petisi_tb %>%
  filter(str_detect(alasan, "tri hita")) %>%
  arrange(desc(likes)) %>%
  select(alasan) %>%
  print()
```


# Topic

## Topik Petisi 1


## Topik Petisi 2


## Topik Petisi 3
